(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["cart"],{a434:function(t,e,r){"use strict";var a=r("23e7"),n=r("23cb"),s=r("a691"),c=r("50c4"),o=r("7b0b"),i=r("65f0"),l=r("8418"),u=r("1dde"),d=u("splice"),f=Math.max,h=Math.min,b=9007199254740991,p="Maximum allowed length exceeded";a({target:"Array",proto:!0,forced:!d},{splice:function(t,e){var r,a,u,d,m,x,g=o(this),w=c(g.length),k=n(t,w),v=arguments.length;if(0===v?r=a=0:1===v?(r=0,a=w-k):(r=v-2,a=h(f(s(e),0),w-k)),w+r-a>b)throw TypeError(p);for(u=i(g,a),d=0;d<a;d++)m=k+d,m in g&&l(u,d,g[m]);if(u.length=a,r<a){for(d=k;d<w-a;d++)m=d+a,x=d+r,m in g?g[x]=g[m]:delete g[x];for(d=w;d>w-a+r;d--)delete g[d-1]}else if(r>a)for(d=w-a;d>k;d--)m=d+a-1,x=d+r-1,m in g?g[x]=g[m]:delete g[x];for(d=0;d<r;d++)g[d+k]=arguments[d+2];return g.length=w-a+r,u}})},b789:function(t,e,r){"use strict";r.r(e);var a=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("b-container",{staticClass:"page px-5",attrs:{fluid:"",id:"cart"}},[r("b-row",[r("b-col",[r("h3",{staticClass:"text-left mt-4"},[r("span",{staticClass:"font-weight-bold title"},[t._v("購物車")])])])],1),r("hr",{staticClass:"mb-5"}),r("b-row",[r("b-col",{attrs:{cols:"12"}},[r("b-table",{ref:"table",staticClass:"table-striped table-bordered text-left mb-4",attrs:{items:t.cart,fields:t.fields,responsive:""},scopedSlots:t._u([{key:"cell(image)",fn:function(t){return[r("img",{staticStyle:{height:"100px"},attrs:{src:t.item.image}})]}},{key:"cell(action)",fn:function(e){return[r("b-btn",{staticClass:"w-50",attrs:{variant:"danger",size:"lg"},on:{click:function(r){return t.delProduct(e.index)}}},[r("b-icon",{attrs:{icon:"trash-fill"}}),t._v(" 刪除商品")],1)]}}])})],1),r("b-col",{staticClass:"mb-4 d-flex justify-content-center",attrs:{cols:"12"}},[r("b-btn",{staticClass:"w-50",attrs:{variant:"success",size:"lg"},on:{click:t.checkout}},[r("b-icon",{attrs:{icon:"cash"}}),t._v(" 結帳")],1)],1)],1)],1)},n=[],s=r("5530"),c=r("1da1"),o=(r("96cf"),r("a434"),r("d81d"),r("99af"),r("4de4"),{name:"Cart",data:function(){return{cart:[],fields:[{key:"image",label:"商品圖片"},{key:"name",label:"商品名稱"},{key:"description",label:"商品說明"},{key:"action",label:""}],donateAmount:""}},methods:{delProduct:function(t){var e=this;return Object(c["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,e.axios.patch("/users/cart",{product:e.cart[t]._id},{headers:{authorization:"Bearer "+e.$store.state.jwt.token}});case 3:e.cart.splice(t,1),e.$refs.table.refresh(),r.next=11;break;case 7:r.prev=7,r.t0=r["catch"](0),console.log(r.t0),e.$swal({icon:"error",title:"錯誤",text:"刪除商品失敗"});case 11:case"end":return r.stop()}}),r,null,[[0,7]])})))()},checkout:function(){var t=this;return Object(c["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!(t.donateAmount>0)){e.next=13;break}return e.prev=1,e.next=4,t.axios.post("/orders",{},{headers:{authorization:"Bearer "+t.$store.state.jwt.token}});case 4:t.$swal({icon:"success",title:"成功",text:"結帳完成"}),t.$router.push("/user/userboughtlist"),e.next=11;break;case 8:e.prev=8,e.t0=e["catch"](1),t.$swal({icon:"error",title:"錯誤",text:"結帳失敗"});case 11:e.next=14;break;case 13:t.$swal({icon:"error",title:"錯誤",text:"至少捐過一本書並通過審核後才能下單"});case 14:case"end":return e.stop()}}),e,null,[[1,8]])})))()}},mounted:function(){var t=this;return Object(c["a"])(regeneratorRuntime.mark((function e(){var r,a,n,c;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.axios.get("/users/cart",{headers:{authorization:"Bearer "+t.$store.state.jwt.token}});case 3:return r=e.sent,a=r.data,t.cart=a.result.map((function(t){return t=Object(s["a"])({},t.product),t.image="".concat("https://book-x-book-shop.herokuapp.com","/files/").concat(t.image),t})),t.$store.commit("cart",a.result.length),e.next=9,t.axios.get("/products/from/"+t.$store.state.user.id,{headers:{authorization:"Bearer "+t.$store.state.jwt.token}});case 9:n=e.sent,c=n.data.result.filter((function(t){return t.checked})).length,t.donateAmount=c,console.log(c),e.next=18;break;case 15:e.prev=15,e.t0=e["catch"](0),t.$swal({icon:"error",title:"錯誤",text:"取得購物車失敗"});case 18:case"end":return e.stop()}}),e,null,[[0,15]])})))()}}),i=o,l=r("2877"),u=Object(l["a"])(i,a,n,!1,null,null,null);e["default"]=u.exports}}]);
//# sourceMappingURL=cart.fc656dfe.js.map